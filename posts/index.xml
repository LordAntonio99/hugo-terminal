<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on La web de Antonio</title><link>https://lordantonio99.github.io/hugo-terminal/posts/</link><description>Recent content in Posts on La web de Antonio</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 03 Feb 2022 13:43:56 +0100</lastBuildDate><atom:link href="https://lordantonio99.github.io/hugo-terminal/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Servidores DHCP Teoría</title><link>https://lordantonio99.github.io/hugo-terminal/posts/servidoresdhcp/</link><pubDate>Thu, 03 Feb 2022 13:43:56 +0100</pubDate><guid>https://lordantonio99.github.io/hugo-terminal/posts/servidoresdhcp/</guid><description>Servidores DHCP Introducción DHCP es un protocolo de configuración dinámica de hosts, con el que asignamos Ips dentro de un rango que establecemos.
Su principal función es que los dispositivos de una red obtengan su configuración de internet de forma automática.
Los hosts que proporcionan servicios de red no deberían usar esta configuración, ya que dependen de ella y pueden desconectarse o causar errores.
Componentes de un servidor DHCP Sus componentes son:</description><content>&lt;h1 id="servidores-dhcp">Servidores DHCP&lt;/h1>
&lt;h2 id="introducción">Introducción&lt;/h2>
&lt;p>DHCP es un protocolo de configuración dinámica de hosts, con el que asignamos Ips dentro de un rango que establecemos.&lt;/p>
&lt;p>Su principal función es que los dispositivos de una red obtengan su configuración de internet de forma automática.&lt;/p>
&lt;p>Los hosts que proporcionan servicios de red no deberían usar esta configuración, ya que dependen de ella y pueden desconectarse o causar errores.&lt;/p>
&lt;h2 id="componentes-de-un-servidor-dhcp">Componentes de un servidor DHCP&lt;/h2>
&lt;p>Sus componentes son:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Servidor DHCP: asigna la configuración a los clientes.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Clientes DHCP: realizan las peticiones al servidor y configuran sus parámetros con los que el servidor les devuelve.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Protocolo DHCP: conjunto de normas y reglas de diálogo entre el servidor y el cliente.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Agentes de retransmisión DHCP: escuchan las peticiones de los clientes y las retransmiten a los servidores.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="tipos-de-asignación">Tipos de asignación&lt;/h2>
&lt;p>Dentro de la asignación de Ips de DHCP, podemos configurar diferentes tipos:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Manual o estática: se trata de direcciones concretas para máquinas las cuales van a obtener siempre la misma configuración, puesto que estarán reservadas.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Dinámica: asigna una Ip aleatoria dentro del rango durante un tiempo establecido (lease time)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Automática: se asigna una dirección Ip al cliente hasta que este se desconecta y la libera, con un tiempo ilimitado.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>El rango de direcciones es el intervalo consecutivo de estas, las cuales son válidas y están disponibles para ser asignadas.&lt;/p>
&lt;p>De la misma manera que podemos definir una Ip para que se asigne de forma estática, también podemos excluirlas para que no se puedan conceder a nuevas máquinas. Estas suelen ser reservadas para servidores, routers&amp;hellip;&lt;/p>
&lt;p>El tiempo de concesión o lease time es el tiempo que un cliente DHCP mantiene sus datos de configuración otorgados por el servidor. Una vez vencido este tiempo, puede solicitar su renovación o una desconexión.&lt;/p>
&lt;h2 id="servidores-dhcp-1">Servidores DHCP&lt;/h2>
&lt;p>Permiten asignar la configuración de red al resto de máquinas presentes en la red cuando estos inician sus interfaces de red. Por defecto, el puerto de escucha es el 67 mediante UDP.&lt;/p>
&lt;p>Los parámetros que estos servidores configuran son:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Dirección Ip&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Máscara de subred&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Puerta de enlace&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Servidores DNS&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Nombre DNS&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Algunos de los ejemplos de servidores DHCP son:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ISC DHCP: servidor para Linux&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Servidor DHCP de Microsoft: principalmente para Windows Server&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Servidor DHCP integrados en routers: en ocasiones un router particular puede incluir este servicio.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="clientes-dhcp">Clientes DHCP&lt;/h2>
&lt;p>Son los que realizan peticiones al servidor DHCP y configuran sus parámetros con los que reciben del propio servidor. Para estas tareas, utilizan el puerto 68 mediante UDP. Estos clientes vienen integrados por defecto en los sistemas operativos.&lt;/p>
&lt;h2 id="tipos-de-opciones">Tipos de opciones&lt;/h2>
&lt;p>Los parámetros que el servidor envía a los clientes se pueden establecer a diferentes niveles:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Opciones de servidor: se envían a todos los clientes.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Opciones de ámbito: se envían a todos los clientes del ámbito y sobrescriben a los del servidor.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Opciones de clase: se envían a los clientes de pendiendo de a que clase pertenecen.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Opciones de equipo: se define para un equipo concreto mediante una reserva. Este tipo de configuración sobrescribe a todas las demás.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="protocolo-dhcp">Protocolo DHCP&lt;/h2>
&lt;p>Determina el conjunto de normas y reglas en base a las cuales dialogan os clientes y servidores.&lt;/p>
&lt;p>El formato de un mensaje DHCP tiene una parte fija que aparece en todos los mensajes, aunque irá cambiando conforme se obtengan opciones específicas.&lt;/p>
&lt;h2 id="funcionamiento">Funcionamiento&lt;/h2>
&lt;p>Los pasos que sigue el servicio DHCP son los siguientes:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Un cliente DHCP envía una solicitud en forma de broadcast a través de la red para solicitar una configuración.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Todos los servidores alcanzados por la solicitud responden al cliente.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El cliente acepta una de estas, haciéndoselo saber al servidor elegido.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El servidor le otorga la información requerida.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Esta información se mantiene asociada al cliente mientras éste no desactive su interfaz o no expire el plazo de concesión.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Cuando expira el plazo, el cliente puede pedir una renovación.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="obtención-de-una-concesión">Obtención de una concesión&lt;/h3>
&lt;p>Sigue los siguientes pasos:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Descubrimiento DHCP ( DHCPDISCOVER ): el cliente manda la señal de broadcast desde el puerto 68 a todos los puertos 67, que serán donde los servidores escuchen.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Oferta DHCP ( DHCPOFFER ): los servidores responden al puerto 68 del cliente, enviándole una ip y algunos parámetros de configuración. Durante este paso, la dirección ip enviada se reserva.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Solicitud DHCP ( DHCPREQUEST ): el cliente recibe una o más ofertas de servidores y elige la que mejor funcione y envía un mensaje DHCPREQUEST poniendo como destino al servidor elegido. En caso de no recibir la respuesta con DHCPOFFER, reenvía un nuevo mensaje.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Reconocimiento DHCP ( DHCPACK ): Si el mensaje DHCPREQUEST no contiene su dirección, el servidor la considera rechazada, en caso de que sea correcta y la Ip siga disponible, el servidor enviará un mensaje DHCPACK, en caso de no estarlo, se enviará un mensaje DHCPNACK.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>Los clientes, normalmente intentan renovar su concesión:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Cuando inician su interfaz, para asegurarse de poder usar la dirección Ip anteriormente otorgada, y si no pueden, solicitar una nueva.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Antes de que finalice el periodo de concesión, para garantizar que la información de configuración quede actualizada.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Manualmente desde el cliente en cualquier otro momento&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>El cliente puede elegir abandonar su alquiler de una dirección enviando el mensaje DHCPRELEASE al servidor.&lt;/p>
&lt;p>Se pueden actualizar los parámetros de configuración cuando el cliente contacta con el servidor para cualquier acción de todas las anteriores.&lt;/p>
&lt;h2 id="mensajes-dhcp">Mensajes DHCP&lt;/h2>
&lt;p>Tenemos principalmente 8 mensajes diferentes:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>DHCPDISCOVER: mensaje que envía el cliente a la red para solicitar unirse a un servidor.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPOFFER: mensaje que envía el servidor como respuesta al cliente que la ha solicitado.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPREQUEST: mensaje que envía el cliente como respuesta a la oferta que le ha realizado un servidor.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPACK: mensaje de confirmación y cierre desde el servidor hacia el cliente indicándole los parámetros definitivos.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPNACK: mensaje que informa desde el servidor al cliente de que la Ip solicitada no es válida, o la configuración incluye algún error.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPDECLINE: el cliente informa al servidor de que la dirección está en uso.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPRELEASE: el cliente informa al servidor de que ha finalizado su uso con la Ip.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DHCPINFORM: el cliente consulta al servidor la configuración local.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="configuración-de-varios-servidores">Configuración de varios servidores&lt;/h2>
&lt;p>Un servidor DHCP debe estar en la misma red física que los clientes. Si se dispone de varias redes para conectar, tenemos diferentes opciones:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Configurar un servidor DHCP en cada subred: esta opción supone un aumento del trabajo administrativo y del equipo necesario, ya que habrá que ubicar un servidor DHCP en cada subred individual.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Configurar un servidor DHCP desde una ubicación centralizada a varias subredes: en este caso se pueden contemplar varias opciones&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Conectar el servidor directamente a las diferentes redes&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Que los enrutadores tengan capacidad de retransmitir mensajes DHCP entre redes&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Instalar un agente de retransmisión DHCP en algún equipo y configurarlo para escuchar los mensajes y redirigirlos a un servidor DHCP específico.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="agente-de-retransmisión-dhcp">Agente de retransmisión DHCP&lt;/h2>
&lt;p>Se trata de un equipo o enrutador configurado para escuchar difusiones DHCP procedentes de clientes, y a continuación, retransmitir dichos mensajes a los servidores.&lt;/p>
&lt;p>Los tipos de agentes de retransmisión DHCP pueden ser:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Integrados en routers&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Servidor que funcione como agente de retransmisión&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Para que un servidor funcione como agente de retransmisión, el funcionamiento debe ser el siguiente.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>El cliente difunde un mensaje DHCPDISCOVER&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El agente de retransmisión de la subred del cliente reenvía el mensaje al servidor mediante unidifusión.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El servidor emplea unidifusión para enviar el mensaje de DHCPOFFER al agente.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El agente de retransmisión difunde el DHCPOFFER a la subred del cliente.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El cliente difunde el mensaje DHCPREQUEST&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El agente de retransmisión recoge el mensaje y se lo envía al servidor mediante unidifusión.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>El servidor genera el mensaje DHCPACK, que se le envía de nuevo al agente.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Finalmente el agente envía este último mensaje a la subred del cliente.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>El servidor DHCP dará la configuración dará una configuración de red adecuada al segmento de red al que está conectado el equipo que efectúa la petición.&lt;/p>
&lt;h1 id="protocolo-de-failover-en-dhcp">Protocolo de failover en DHCP&lt;/h1>
&lt;p>Cuando 2 servidores DHCP se encuentran en la misma red, ambos mantienen una base de datos con sus concesiones y sus estados. Para evitar que la misma dirección Ip se asigne a varios equipos, la solución es que estos trabajen con distintos rangos de direcciones.&lt;/p>
&lt;p>Si ambos servidores desean trabajar con el mismo rango de direcciones, es necesario que sus bases de datos estén sincronizadas. Para esto se utiliza el protocolo Failover entre 2 servidores DHCP.&lt;/p>
&lt;p>Este protocolo también se puede utilizar para realizar un balanceo de carga, de manera que el trabajo se reparta entre los servidores primario y secundario.&lt;/p></content></item><item><title>Servidordnsmasq</title><link>https://lordantonio99.github.io/hugo-terminal/posts/servidordnsmasq/</link><pubDate>Thu, 03 Feb 2022 13:16:32 +0100</pubDate><guid>https://lordantonio99.github.io/hugo-terminal/posts/servidordnsmasq/</guid><description>Instalación Para instalar el servicio, utilizaremos el siguiente comando:
apt-get install dnsmasq Una vez instalado el paquete, procederemos a levantar el servicio con el siguiente comando:
systemctl start dnsmasq Con esto tenemos lista la parte de instalación y preparación del servicio.
Servidor DNS Caché A continuación configuraremos el servidor para que el servidor dnsmasq pueda ser un servidor caché DNS. Para ello tendremos que modificar el archivo &amp;ldquo;/etc/resolv.conf&amp;rdquo;, donde especificaremos que servidores de DNS externos van a actuar en caso de que el propio servidor no tenga una respuesta.</description><content>&lt;h2 id="instalación">Instalación&lt;/h2>
&lt;p>Para instalar el servicio, utilizaremos el siguiente comando:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">apt-get install dnsmasq
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Una vez instalado el paquete, procederemos a levantar el servicio con el siguiente comando:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">systemctl start dnsmasq
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Con esto tenemos lista la parte de instalación y preparación del servicio.&lt;/p>
&lt;h2 id="servidor-dns-caché">Servidor DNS Caché&lt;/h2>
&lt;p>A continuación configuraremos el servidor para que el servidor dnsmasq pueda ser un servidor caché DNS. Para ello tendremos que modificar el archivo &amp;ldquo;/etc/resolv.conf&amp;rdquo;, donde especificaremos que servidores de DNS externos van a actuar en caso de que el propio servidor no tenga una respuesta. La configuración que utilizaremos será con los 2 servidores DNS de google, de forma que el archivo quede de la siguiente manera:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">nameserver 8.8.8.8
nameserver 8.8.4.4
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Una vez modificado este archivo, reiniciamos el servicio de la red con el comando:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">systemctl restart networking
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Para comprobar su funcionamiento, vamos a ejecutar un comando de &amp;ldquo;nslookup&amp;rdquo; con una dirección de internet para comprobar que se resuelve y que servidor lo hace:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">nslookup www.google.es
Server: 8.8.8.8
Address: 8.8.8.8#53
Non-authoritative answer:
Name: www.google.es
Address: 142.250.184.163
Name: www.google.es
Address: 2a00:1450:4003:80c::2003
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Con esto la configuración del servidor está completada, ahora solo falta modificar el archivo &amp;ldquo;/etc/resolv.conf&amp;rdquo; del resto de los ordenadores de la red para que su servidor DNS sea el de dnsmasq. Para ello pondremos la siguiente configuración:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">nameserver 10.0.0.5
&lt;/code>&lt;/pre>&lt;/div>&lt;p>La ip seleccionada es la del servidor.&lt;/p>
&lt;p>A continuación podemos probar a resolver nombres desde cualquier otra máquina, dándonos el siguiente resultado:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">nslookup www.iespabloserrano.com
Server: 10.0.0.5
Address: 10.0.0.5#53
Non-authoritative answer:
Name: www.iespabloserrano.com
Address: 82.98.135.44
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="servidor-dns-maestro">Servidor DNS maestro&lt;/h2>
&lt;p>Para realizar la configuración como un servidor maestro, vamos a tener que escribir los diferentes hosts dentro del archivo &amp;ldquo;/etc/hosts&amp;rdquo;, en el que escribiremos las siguientes entradas:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">10.0.0.5 dns.asir2.com
10.0.0.2 pc01.asir2.com
10.0.0.1 router.asir2.com
10.0.1.1 router.asir2.com
10.0.1.2 pc02.asir2.com
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Una vez guardado el archivo con los cambios, simplemente tendremos que reiniciar el servicio con el comando:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">systemctl restart dnsmasq
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Si ahora realizamos una consulta desde cualquier ordenador de la red, esto es lo que obtenemos:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">nslookup pc01.asir2.com
Server: 10.0.0.5
Address: 10.0.0.5#53
Name: pc01.asir2.com
Address: 10.0.0.2
nslookup router.asir2.com
Server: 10.0.0.5
Address: 10.0.0.5#53
Name: router.asir2.com
Address: 10.0.1.1
Name: router.asir2.com
Address: 10.0.0.1
&lt;/code>&lt;/pre>&lt;/div></content></item></channel></rss>